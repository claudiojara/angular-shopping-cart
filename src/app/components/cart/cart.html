<div class="cart-container">
  <mat-card class="cart-card">
    <mat-card-header>
      <mat-card-title>
        <div class="cart-title" data-testid="cart-title">
          <mat-icon>shopping_cart</mat-icon>
          <span>Carrito de Compras</span>
          @if (itemCount() > 0) {
            <span class="item-count" [matBadge]="itemCount()" matBadgeColor="accent" data-testid="cart-item-count"></span>
          }
        </div>
      </mat-card-title>
    </mat-card-header>

    <mat-card-content>
      @if (items().length === 0) {
        <div class="empty-cart" data-testid="empty-cart-message">
          <mat-icon class="empty-icon">shopping_cart</mat-icon>
          <h2>Tu carrito está vacío</h2>
          <p>Agrega productos para comenzar tu compra</p>
        </div>
      } @else {
        <mat-list class="cart-items" data-testid="cart-items-list">
          @for (item of items(); track item.product.id) {
            <mat-list-item class="cart-item" [attr.data-testid]="'cart-item-' + item.product.id">
              <div class="item-content">
                <img [src]="item.product.image" [alt]="item.product.name" class="item-image" [attr.data-testid]="'cart-item-image-' + item.product.id" />
                
                <div class="item-details">
                  <h3 class="item-name" [attr.data-testid]="'cart-item-name-' + item.product.id">{{ item.product.name }}</h3>
                  <p class="item-price" [attr.data-testid]="'cart-item-price-' + item.product.id">{{ item.product.price | currency }}</p>
                  
                  <div class="quantity-controls">
                    <button 
                      mat-mini-fab 
                      color="primary" 
                      (click)="updateQuantity(item.product.id, item.quantity - 1)"
                      [disabled]="item.quantity <= 1"
                      [attr.data-testid]="'decrease-quantity-' + item.product.id"
                      matTooltip="Disminuir cantidad"
                      matTooltipPosition="above"
                      aria-label="Disminuir cantidad">
                      <mat-icon>remove_circle_outline</mat-icon>
                    </button>
                    
                    <span class="quantity" [attr.data-testid]="'quantity-' + item.product.id">{{ item.quantity }}</span>
                    
                    <button 
                      mat-mini-fab 
                      color="primary" 
                      (click)="updateQuantity(item.product.id, item.quantity + 1)"
                      [attr.data-testid]="'increase-quantity-' + item.product.id"
                      matTooltip="Aumentar cantidad"
                      matTooltipPosition="above"
                      aria-label="Aumentar cantidad">
                      <mat-icon>add_circle_outline</mat-icon>
                    </button>
                  </div>
                </div>

                <div class="item-actions">
                  <p class="item-subtotal" [attr.data-testid]="'cart-item-subtotal-' + item.product.id">{{ item.product.price * item.quantity | currency }}</p>
                  <button 
                    mat-mini-fab 
                    color="warn" 
                    (click)="removeItem(item.product.id)"
                    [attr.data-testid]="'remove-item-' + item.product.id"
                    matTooltip="Eliminar del carrito"
                    matTooltipPosition="left"
                    aria-label="Eliminar producto del carrito">
                    <mat-icon>delete</mat-icon>
                  </button>
                </div>
              </div>
            </mat-list-item>
            <mat-divider></mat-divider>
          }
        </mat-list>

        <div class="cart-summary" data-testid="cart-summary">
          <div class="total-section">
            <h2>Total</h2>
            <h2 class="total-amount" data-testid="cart-total-amount">{{ total() | currency }}</h2>
          </div>

          <div class="action-buttons">
            <button 
              mat-raised-button 
              color="warn" 
              (click)="clearCart()"
              data-testid="clear-cart-button"
              aria-label="Vaciar carrito completamente"
              class="clear-btn">
              <mat-icon>delete_sweep</mat-icon>
              Vaciar Carrito
            </button>
            
            <button 
              mat-raised-button 
              color="primary" 
              (click)="checkout()"
              data-testid="checkout-button"
              aria-label="Proceder al pago"
              class="checkout-btn">
              <mat-icon>payment</mat-icon>
              Proceder al Pago
            </button>
          </div>
        </div>
      }
    </mat-card-content>
  </mat-card>
</div>
