#!/bin/bash

# Branch Protection Setup Guide
# Este script documenta los pasos para configurar branch protection en GitHub
# No puede ejecutarse automÃ¡ticamente - debes seguir los pasos en GitHub UI

echo "ğŸ”’ Branch Protection Rules Setup Guide"
echo "======================================"
echo ""
echo "âš ï¸  IMPORTANTE: Estos pasos deben realizarse manualmente en GitHub"
echo "    GitHub API requiere una GitHub App para automatizar esto"
echo ""
echo "ğŸ“ URL: https://github.com/claudiojara/angular-shopping-cart/settings/branches"
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ğŸŸ¢ REGLA 1: ProtecciÃ³n para 'main' (ProducciÃ³n)"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "Branch name pattern: main"
echo ""
echo "âœ… Require a pull request before merging"
echo "   - Required number of approvals: 1"
echo "   - âœ… Dismiss stale pull request approvals when new commits are pushed"
echo "   - âœ… Require review from Code Owners"
echo ""
echo "âœ… Require status checks to pass before merging"
echo "   - âœ… Require branches to be up to date before merging"
echo "   - Status checks required:"
echo "     â€¢ quality-checks"
echo "     â€¢ deploy-production"
echo ""
echo "âœ… Require conversation resolution before merging"
echo ""
echo "âœ… Require linear history"
echo ""
echo "âœ… Do not allow bypassing the above settings"
echo ""
echo "âœ… Restrict who can push to matching branches"
echo "   - Limit to: Maintainers"
echo ""
echo "âŒ Allow force pushes: Disabled"
echo "âŒ Allow deletions: Disabled"
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ğŸŸ¡ REGLA 2: ProtecciÃ³n para 'develop' (Staging)"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "Branch name pattern: develop"
echo ""
echo "âœ… Require a pull request before merging"
echo "   - Required number of approvals: 1"
echo "   - âœ… Dismiss stale pull request approvals when new commits are pushed"
echo "   - âŒ Require review from Code Owners (opcional)"
echo ""
echo "âœ… Require status checks to pass before merging"
echo "   - âœ… Require branches to be up to date before merging"
echo "   - Status checks required:"
echo "     â€¢ quality-checks"
echo "     â€¢ deploy-staging"
echo ""
echo "âœ… Require conversation resolution before merging"
echo ""
echo "âœ… Require linear history"
echo ""
echo "âš ï¸  Do not allow bypassing the above settings"
echo "   - Recomendado: Enabled (puedes hacer bypass en emergencias)"
echo ""
echo "âŒ Restrict who can push to matching branches: Disabled"
echo "   (Permite pushes directos en emergencias)"
echo ""
echo "âŒ Allow force pushes: Disabled"
echo "âŒ Allow deletions: Disabled"
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ğŸ“ PASO ADICIONAL: Crear CODEOWNERS"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "Crear archivo: .github/CODEOWNERS"
echo ""
echo "Contenido sugerido:"
echo "---"
echo "# Global owners"
echo "*       @claudiojara"
echo ""
echo "# Core services"
echo "/src/app/services/          @claudiojara"
echo "/src/app/core/              @claudiojara"
echo ""
echo "# CI/CD"
echo "/.github/workflows/         @claudiojara"
echo "/scripts/                   @claudiojara"
echo "/.azure/                    @claudiojara"
echo ""
echo "# Documentation"
echo "*.md                        @claudiojara"
echo "/docs/                      @claudiojara"
echo "---"
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "âš™ï¸  CONFIGURACIÃ“N ADICIONAL: Merge Settings"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "ğŸ“ URL: https://github.com/claudiojara/angular-shopping-cart/settings"
echo ""
echo "En 'Pull Requests' section:"
echo ""
echo "âœ… Allow squash merging"
echo "   - Default to pull request title"
echo "   - Default commit message: Pull request title and description"
echo ""
echo "âœ… Allow rebase merging"
echo ""
echo "âŒ Allow merge commits (bloqueado por linear history)"
echo ""
echo "âœ… Automatically delete head branches"
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "âœ… CHECKLIST DE VERIFICACIÃ“N"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "DespuÃ©s de configurar, verifica que:"
echo ""
echo "[ ] Branch protection para 'main' estÃ¡ activa"
echo "[ ] Branch protection para 'develop' estÃ¡ activa"
echo "[ ] Status checks requeridos estÃ¡n seleccionados"
echo "[ ] Linear history estÃ¡ habilitado"
echo "[ ] Squash merge es el mÃ©todo default"
echo "[ ] Auto-delete head branches estÃ¡ habilitado"
echo "[ ] CODEOWNERS estÃ¡ creado (si aplica)"
echo "[ ] No puedes hacer force push a main/develop"
echo "[ ] No puedes hacer merge sin approval"
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "ğŸ“š DocumentaciÃ³n completa: docs/BRANCH_PROTECTION.md"
echo ""
echo "âœ… Una vez configurado, las ramas estarÃ¡n protegidas contra:"
echo "   â€¢ Merges sin review"
echo "   â€¢ Merges con CI fallando"
echo "   â€¢ Force pushes destructivos"
echo "   â€¢ Borrado accidental"
echo ""
echo "ğŸ‰ Â¡ConfiguraciÃ³n completa para flujo GitFlow seguro!"
